import{d as g,w as x}from"./index.NQB3_1Bs.js";import{w as y}from"./array.Da8vNzNy.js";import{i as I,f as c,w,n as v,u as T,e as C}from"./create.CWXb-gbW.js";import{s as A,c as F,u as M}from"./dialog-trigger.Ds943kLH.js";import{M as O}from"./scheduler.C5Rd-ZIZ.js";import{u as S}from"./helpers.DIsaCIF_.js";import{u as L}from"./portal.ZBoujvSR.js";function G(e){e.setAttribute("data-highlighted","")}function W(e){e.removeAttribute("data-highlighted")}function k(e,n=500){let t=null;return function(...s){const a=()=>{t=null,e(...s)};t&&clearTimeout(t),t=setTimeout(a,n)}}function $(e){const{open:n,forceVisible:t,activeTrigger:s}=e;return g([n,t,s],([a,r,i])=>(a||r)&&i!==null)}function K(e){I&&A(1).then(()=>{const n=document.activeElement;!c(n)||n===e||(n.tabIndex=-1,e&&(e.tabIndex=0,e.focus()))})}function m(){return Array.from(document.querySelectorAll('a[href]:not([tabindex="-1"]), button:not([disabled]):not([tabindex="-1"]), input:not([disabled]):not([tabindex="-1"]), select:not([disabled]):not([tabindex="-1"]), textarea:not([disabled]):not([tabindex="-1"]), [tabindex]:not([tabindex="-1"])'))}function J(e){const n=m(),s=n.indexOf(e)+1,a=n[s];return s<n.length&&c(a)?a:null}function Q(e){const n=m(),s=n.indexOf(e)-1,a=n[s];return s>=0&&c(a)?a:null}const P=new Set(["Shift","Control","Alt","Meta","CapsLock","NumLock"]),D={onMatch:K,getCurrentItem:()=>document.activeElement};function U(e={}){const n={...D,...e},t=w(x([])),s=k(()=>{t.update(()=>[])});return{typed:t,resetTyped:s,handleTypeaheadSearch:(r,i)=>{if(P.has(r))return;const d=n.getCurrentItem(),o=O(t);if(!Array.isArray(o))return;o.push(r.toLowerCase()),t.set(o);const h=i.filter(u=>!(u.getAttribute("disabled")==="true"||u.getAttribute("aria-disabled")==="true"||u.hasAttribute("data-disabled"))),b=o.length>1&&o.every(u=>u===o[0])?o[0]:o.join(""),p=c(d)?h.indexOf(d):-1;let l=y(h,Math.max(p,0));b.length===1&&(l=l.filter(u=>u!==d));const f=l.find(u=>(u==null?void 0:u.innerText)&&u.innerText.toLowerCase().startsWith(b.toLowerCase()));c(f)&&f!==d&&n.onMatch(f),s()}}}const H={floating:{},focusTrap:{},modal:{},escapeKeydown:{},portal:"body"},X=(e,n)=>{e.dataset.escapee="";const{anchorElement:t,open:s,options:a}=n;if(!t||!s||!a)return{destroy:v};const r={...H,...a},i=[];if(r.portal!==null&&i.push(L(e,r.portal).destroy),i.push(S(t,e,r.floating).destroy),r.focusTrap!==null){const{useFocusTrap:o}=F({immediate:!0,escapeDeactivates:!1,allowOutsideClick:!0,returnFocusOnDeactivate:!1,fallbackFocus:e,...r.focusTrap});i.push(o(e).destroy)}r.modal!==null&&i.push(M(e,{onClose:()=>{c(t)&&(s.set(!1),t.focus())},shouldCloseOnInteractOutside:o=>!(o.defaultPrevented||c(t)&&t.contains(o.target)),...r.modal}).destroy),r.escapeKeydown!==null&&i.push(T(e,{enabled:s,handler:()=>{s.set(!1)},...r.escapeKeydown}).destroy);const d=C(...i);return{destroy(){d()}}};export{Q as a,G as b,U as c,$ as d,J as g,K as h,W as r,X as u};
