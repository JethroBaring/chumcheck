import{d as xe,w as G,r as Ie}from"./index.NQB3_1Bs.js";import{p as de,n as Ke}from"./stores.Db8Y0sLC.js";import{ag as Pe,_ as De,M as me}from"./scheduler.C5Rd-ZIZ.js";import{U as it,N as Mt,P as Ft,a as kt,b as at,H as It,p as Ot,i as st,c as ve,d as jt,g as Pt}from"./entry.BUvncCIv.js";const Dt=!0;class Oe extends Error{constructor(r,s){super(r),this.name="DevalueError",this.path=s.join("")}}function Xe(n){return Object(n)!==n}const Ct=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Lt(n){const r=Object.getPrototypeOf(n);return r===Object.prototype||r===null||Object.getOwnPropertyNames(r).sort().join("\0")===Ct}function Nt(n){return Object.prototype.toString.call(n).slice(8,-1)}function Rt(n){switch(n){case'"':return'\\"';case"<":return"\\u003C";case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return n<" "?`\\u${n.charCodeAt(0).toString(16).padStart(4,"0")}`:""}}function fe(n){let r="",s=0;const t=n.length;for(let f=0;f<t;f+=1){const o=n[f],a=Rt(o);a&&(r+=n.slice(s,f)+a,s=f+1)}return`"${s===0?n:r+n.slice(s)}"`}function xt(n,r){const s=[],t=new Map,f=[];for(const p in r)f.push({key:p,fn:r[p]});const o=[];let a=0;function c(p){if(typeof p=="function")throw new Oe("Cannot stringify a function",o);if(t.has(p))return t.get(p);if(p===void 0)return it;if(Number.isNaN(p))return Mt;if(p===1/0)return Ft;if(p===-1/0)return kt;if(p===0&&1/p<0)return at;const w=a++;t.set(p,w);for(const{key:C,fn:T}of f){const V=T(p);if(V)return s[w]=`["${C}",${c(V)}]`,w}let y="";if(Xe(p))y=je(p);else switch(Nt(p)){case"Number":case"String":case"Boolean":y=`["Object",${je(p)}]`;break;case"BigInt":y=`["BigInt",${p}]`;break;case"Date":y=`["Date","${p.toISOString()}"]`;break;case"RegExp":const{source:T,flags:V}=p;y=V?`["RegExp",${fe(T)},"${V}"]`:`["RegExp",${fe(T)}]`;break;case"Array":y="[";for(let E=0;E<p.length;E+=1)E>0&&(y+=","),E in p?(o.push(`[${E}]`),y+=c(p[E]),o.pop()):y+=It;y+="]";break;case"Set":y='["Set"';for(const E of p)y+=`,${c(E)}`;y+="]";break;case"Map":y='["Map"';for(const[E,S]of p)o.push(`.get(${Xe(E)?je(E):"..."})`),y+=`,${c(E)},${c(S)}`;y+="]";break;default:if(!Lt(p))throw new Oe("Cannot stringify arbitrary non-POJOs",o);if(Object.getOwnPropertySymbols(p).length>0)throw new Oe("Cannot stringify POJOs with symbolic keys",o);if(Object.getPrototypeOf(p)===null){y='["null"';for(const E in p)o.push(`.${E}`),y+=`,${fe(E)},${c(p[E])}`,o.pop();y+="]"}else{y="{";let E=!1;for(const S in p)E&&(y+=","),E=!0,o.push(`.${S}`),y+=`${fe(S)}:${c(p[S])}`,o.pop();y+="}"}}return s[w]=y,w}const b=c(n);return b<0?`${b}`:`[${s.join(",")}]`}function je(n){const r=typeof n;return r==="string"?fe(n):n instanceof String?fe(n.toString()):n===void 0?it.toString():n===0&&1/n<0?at.toString():r==="bigint"?`["BigInt","${n}"]`:String(n)}const ot=Dt;function Ce(n,r,s){return n[r]=s,"skip"}function Vt(n,r){return r.value!==void 0&&typeof r.value!="object"&&r.path.length<n.length}function re(n,r,s={}){s.modifier||(s.modifier=f=>Vt(r,f)?void 0:f.value);const t=z(n,r,s.modifier);if(t)return s.value===void 0||s.value(t.value)?t:void 0}function z(n,r,s){if(!r.length)return;const t=[r[0]];let f=n;for(;f&&t.length<r.length;){const a=t[t.length-1],c=s?s({parent:f,key:String(a),value:f[a],path:t.map(b=>String(b)),isLeaf:!1,set:b=>Ce(f,a,b)}):f[a];if(c===void 0)return;f=c,t.push(r[t.length])}if(!f)return;const o=r[r.length-1];return{parent:f,key:String(o),value:f[o],path:r.map(a=>String(a)),isLeaf:!0,set:a=>Ce(f,o,a)}}function ee(n,r,s=[]){for(const t in n){const f=n[t],o=f===null||typeof f!="object",a={parent:n,key:t,value:f,path:s.concat([t]),isLeaf:o,set:b=>Ce(n,t,b)},c=r(a);if(c==="abort")return c;if(c==="skip")continue;if(!o){const b=ee(f,r,a.path);if(b==="abort")return b}}}function $t(n,r){return n===r||n.size===r.size&&[...n].every(s=>r.has(s))}function Ze(n,r){const s=new Map;function t(a,c){return a instanceof Date&&c instanceof Date&&a.getTime()!==c.getTime()||a instanceof Set&&c instanceof Set&&!$t(a,c)||a instanceof File&&c instanceof File&&a!==c}function f(a){return a instanceof Date||a instanceof Set||a instanceof File}function o(a,c){const b=c?z(c,a.path):void 0;function p(){return s.set(a.path.join(" "),a.path),"skip"}if(f(a.value)&&(!f(b==null?void 0:b.value)||t(a.value,b.value)))return p();a.isLeaf&&(!b||a.value!==b.value)&&p()}return ee(n,a=>o(a,r)),ee(r,a=>o(a,n)),Array.from(s.values())}function Q(n,r,s){const t=typeof s=="function";for(const f of r){const o=z(n,f,({parent:a,key:c,value:b})=>((b===void 0||typeof b!="object")&&(a[c]={}),a[c]));o&&(o.parent[o.key]=t?s(f,o):s)}}function le(n){return n.toString().split(/[[\].]+/).filter(r=>r)}function oe(n){return n.reduce((r,s)=>{const t=String(s);return typeof s=="number"||/^\d+$/.test(t)?r+=`[${t}]`:r?r+=`.${t}`:r+=t,r},"")}var Ht=pe;function pe(n){let r=n;var s={}.toString.call(n).slice(8,-1);if(s=="Set")return new Set([...n].map(f=>pe(f)));if(s=="Map")return new Map([...n].map(f=>[pe(f[0]),pe(f[1])]));if(s=="Date")return new Date(n.getTime());if(s=="RegExp")return RegExp(n.source,Ut(n));if(s=="Array"||s=="Object"){r=Array.isArray(n)?[]:{};for(var t in n)r[t]=pe(n[t])}return r}function Ut(n){if(typeof n.source.flags=="string")return n.source.flags;var r=[];return n.global&&r.push("g"),n.ignoreCase&&r.push("i"),n.multiline&&r.push("m"),n.sticky&&r.push("y"),n.unicode&&r.push("u"),r.join("")}function B(n){return n&&typeof n=="object"?Ht(n):n}class I extends Error{constructor(r){super(r),Object.setPrototypeOf(this,I.prototype)}}function Bt(n,r){var f;const s={};function t(o){if("_errors"in s||(s._errors=[]),!Array.isArray(s._errors))if(typeof s._errors=="string")s._errors=[s._errors];else throw new I("Form-level error was not an array.");s._errors.push(o.message)}for(const o of n){if(!o.path||o.path.length==1&&!o.path[0]){t(o);continue}const c=!/^\d$/.test(String(o.path[o.path.length-1]))&&((f=re(r,o.path.filter(y=>/\D/.test(String(y)))))==null?void 0:f.value),b=z(s,o.path,({value:y,parent:C,key:T})=>(y===void 0&&(C[T]={}),C[T]));if(!b){t(o);continue}const{parent:p,key:w}=b;c?(w in p||(p[w]={}),"_errors"in p[w]?p[w]._errors.push(o.message):p[w]._errors=[o.message]):w in p?p[w].push(o.message):p[w]=[o.message]}return s}function Qe(n,r,s){return s?n:(ee(r,t=>{Array.isArray(t.value)&&t.set(void 0)}),ee(n,t=>{!Array.isArray(t.value)&&t.value!==void 0||Q(r,[t.path],t.value)}),r)}function qt(n){return ut(n,[])}function ut(n,r){return Object.entries(n).filter(([,t])=>t!==void 0).flatMap(([t,f])=>{if(Array.isArray(f)&&f.length>0){const o=r.concat([t]);return{path:oe(o),messages:f}}else return ut(n[t],r.concat([t]))})}function et(n){!n.flashMessage||!ot||Le(n)&&(document.cookie=`flash=; Max-Age=0; Path=${n.flashMessage.cookiePath??"/"};`)}function Le(n){return!n.flashMessage||!ot?!1:n.syncFlashMessage}function Yt(n){const r=JSON.parse(n);return r.data&&(r.data=Ot(r.data)),r}function tt(n){return HTMLElement.prototype.cloneNode.call(n)}function Gt(n,r=()=>{}){const s=async({action:f,result:o,reset:a=!0,invalidateAll:c=!0})=>{o.type==="success"&&(a&&HTMLFormElement.prototype.reset.call(n),c&&await st()),(location.origin+location.pathname===f.origin+f.pathname||o.type==="redirect"||o.type==="error")&&ve(o)};async function t(f){var V,E,S,J;if(((V=f.submitter)!=null&&V.hasAttribute("formmethod")?f.submitter.formMethod:tt(n).method)!=="post")return;f.preventDefault();const a=new URL((E=f.submitter)!=null&&E.hasAttribute("formaction")?f.submitter.formAction:tt(n).action),c=new FormData(n),b=(S=f.submitter)==null?void 0:S.getAttribute("name");b&&c.append(b,((J=f.submitter)==null?void 0:J.getAttribute("value"))??"");const p=new AbortController;let w=!1;const C=await r({action:a,cancel:()=>w=!0,controller:p,formData:c,formElement:n,submitter:f.submitter})??s;if(w)return;let T;try{const O=await fetch(a,{method:"POST",headers:{accept:"application/json","x-sveltekit-action":"true"},cache:"no-store",body:c,signal:p.signal});T=Yt(await O.text()),T.type==="error"&&(T.status=O.status)}catch(O){if((O==null?void 0:O.name)==="AbortError")return;T={type:"error",error:O}}C({action:a,formData:c,formElement:n,update:O=>s({action:a,result:T,reset:O==null?void 0:O.reset,invalidateAll:O==null?void 0:O.invalidateAll}),result:T})}return HTMLFormElement.prototype.addEventListener.call(n,"submit",t),{destroy(){HTMLFormElement.prototype.removeEventListener.call(n,"submit",t)}}}const ft="noCustomValidity";async function nt(n,r){"setCustomValidity"in n&&n.setCustomValidity(""),!(ft in n.dataset)&&lt(n,r)}function Wt(n,r){for(const s of n.querySelectorAll("input,select,textarea,button")){if(ft in s.dataset)continue;const t=z(r,le(s.name));if(lt(s,t==null?void 0:t.value),t!=null&&t.value)return}}function lt(n,r){const s=r&&r.length?r.join(`
`):"";n.setCustomValidity(s),s&&n.reportValidity()}const zt=(n,r=0)=>{const s=n.getBoundingClientRect();return s.top>=r&&s.left>=0&&s.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&s.right<=(window.innerWidth||document.documentElement.clientWidth)},Jt=(n,r=1.125,s="smooth")=>{const o=n.getBoundingClientRect().top+window.pageYOffset-window.innerHeight/(2*r);window.scrollTo({left:0,top:o,behavior:s})},Kt=["checkbox","radio","range","file"];function rt(n){const r=!!n&&(n instanceof HTMLSelectElement||n instanceof HTMLInputElement&&Kt.includes(n.type)),s=!!n&&n instanceof HTMLSelectElement&&n.multiple,t=!!n&&n instanceof HTMLInputElement&&n.type=="file";return{immediate:r,multiple:s,file:t}}var P;(function(n){n[n.Idle=0]="Idle",n[n.Submitting=1]="Submitting",n[n.Delayed=2]="Delayed",n[n.Timeout=3]="Timeout"})(P||(P={}));const Xt=new Set;function Zt(n,r,s){let t=P.Idle,f,o;const a=Xt;function c(){b(),w(t!=P.Delayed?P.Submitting:P.Delayed),f=window.setTimeout(()=>{f&&t==P.Submitting&&w(P.Delayed)},s.delayMs),o=window.setTimeout(()=>{o&&t==P.Delayed&&w(P.Timeout)},s.timeoutMs),a.add(b)}function b(){clearTimeout(f),clearTimeout(o),f=o=0,a.delete(b),w(P.Idle)}function p(){a.forEach(S=>S()),a.clear()}function w(S){t=S,r.submitting.set(t>=P.Submitting),r.delayed.set(t>=P.Delayed),r.timeout.set(t>=P.Timeout)}const y=n;function C(S){const J=S.target;s.selectErrorText&&J.select()}function T(){s.selectErrorText&&y.querySelectorAll("input").forEach(S=>{S.addEventListener("invalid",C)})}function V(){s.selectErrorText&&y.querySelectorAll("input").forEach(S=>S.removeEventListener("invalid",C))}const E=n;{T();const S=J=>{J.clearAll?p():b(),J.cancelled||setTimeout(()=>Ne(E,s),1)};return Pe(()=>{V(),S({cancelled:!0})}),{submitting(){c()},completed:S,scrollToFirstError(){setTimeout(()=>Ne(E,s),1)},isSubmitting:()=>t===P.Submitting||t===P.Delayed}}}const Ne=async(n,r)=>{if(r.scrollToError=="off")return;const s=r.errorSelector;if(!s)return;await De();let t;if(t=n.querySelector(s),!t)return;t=t.querySelector(s)??t;const f=r.stickyNavbar?document.querySelector(r.stickyNavbar):null;typeof r.scrollToError!="string"?t.scrollIntoView(r.scrollToError):zt(t,(f==null?void 0:f.offsetHeight)??0)||Jt(t,void 0,r.scrollToError);function o(c){return typeof r.autoFocusOnError=="boolean"?r.autoFocusOnError:!/iPhone|iPad|iPod|Android/i.test(c)}if(!o(navigator.userAgent))return;let a;if(a=t,["INPUT","SELECT","BUTTON","TEXTAREA"].includes(a.tagName)||(a=a.querySelector('input:not([type="hidden"]):not(.flatpickr-input), select, textarea')),a)try{a.focus({preventScroll:!0}),r.selectErrorText&&a.tagName=="INPUT"&&a.select()}catch{}};function Se(n,r,s){const t=z(n,r,({parent:f,key:o,value:a})=>(a===void 0&&(f[o]=/\D/.test(o)?{}:[]),f[o]));if(t){const f=s(t.value);t.parent[t.key]=f}return n}function Qt(n,r,s){const t=n.form,f=le(r),o=xe(t,a=>{const c=z(a,f);return c==null?void 0:c.value});return{subscribe(...a){const c=o.subscribe(...a);return()=>c()},update(a,c){t.update(b=>Se(b,f,a),c??s)},set(a,c){t.update(b=>Se(b,f,()=>a),c??s)}}}function en(n,r){const s="form"in n;if(!s&&(r==null?void 0:r.taint)!==void 0)throw new I("If options.taint is set, the whole superForm object must be used as a proxy.");return s}function Ee(n,r,s){const t=le(r);if(en(n,s))return Qt(n,r,s);const f=xe(n,o=>{const a=z(o,t);return a==null?void 0:a.value});return{subscribe(...o){const a=f.subscribe(...o);return()=>a()},update(o){n.update(a=>Se(a,t,o))},set(o){n.update(a=>Se(a,t,()=>o))}}}function Re(n){let r={};const s=Array.isArray(n);for(const[t,f]of Object.entries(n))!f||typeof f!="object"||(s?r={...r,...Re(f)}:r[t]=Re(f));return r}const we=new WeakMap,se=new WeakMap,ct=n=>{console.warn("Unhandled error caught by Superforms, use onError event to handle it:",n.result.error)},tn={applyAction:!0,invalidateAll:!0,resetForm:!0,autoFocusOnError:"detect",scrollToError:"smooth",errorSelector:'[aria-invalid="true"],[data-invalid]',selectErrorText:!1,stickyNavbar:void 0,taintedMessage:!1,onSubmit:void 0,onResult:void 0,onUpdate:void 0,onUpdated:void 0,onError:ct,dataType:"form",validators:void 0,customValidity:!1,clearOnSubmit:"message",delayMs:500,timeoutMs:8e3,multipleSubmits:"prevent",SPA:void 0,validationMethod:"auto"};function nn(n){return`Duplicate form id's found: "${n}". Multiple forms will receive the same data. Use the id option to differentiate between them, or if this is intended, set the warnings.duplicateId option to false in superForm to disable this warning. More information: https://superforms.rocks/concepts/multiple-forms`}let dt=!1;try{SUPERFORMS_LEGACY&&(dt=!0)}catch{}let ue=!1;try{globalThis.STORIES&&(ue=!0)}catch{}function fn(n,r){var Je;let s,t=r??{},f;{if((t.legacy??dt)&&(t.resetForm===void 0&&(t.resetForm=!1),t.taintedMessage===void 0&&(t.taintedMessage=!0)),ue&&t.applyAction===void 0&&(t.applyAction=!1),typeof t.SPA=="string"&&(t.invalidateAll===void 0&&(t.invalidateAll=!1),t.applyAction===void 0&&(t.applyAction=!1)),f=t.validators,t={...tn,...t},(t.SPA===!0||typeof t.SPA=="object")&&t.validators===void 0&&console.warn("No validators set for superForm in SPA mode. Add a validation adapter to the validators option, or set it to false to disable this warning."),!n)throw new I("No form data sent to superForm. Make sure the output from superValidate is used (usually data.form) and that it's not null or undefined. Alternatively, an object with default values for the form can also be used, but then constraints won't be available.");p(n)===!1&&(n={id:t.id??Math.random().toString(36).slice(2,10),valid:!1,posted:!1,errors:{},data:n,shape:Re(n)}),n=n;const e=t.id??n.id,i=me(de)??(ue?{}:void 0);if(((Je=t.warnings)==null?void 0:Je.duplicateId)!==!1)if(!we.has(i))we.set(i,new Set([e]));else{const u=we.get(i);u!=null&&u.has(e)?console.warn(nn(e)):u==null||u.add(e)}if(se.has(n)||se.set(n,n),s=se.get(n),n=B(s),Pe(()=>{var u;St(),ht();for(const l of Object.values(H))l.length=0;(u=we.get(i))==null||u.delete(e),We()}),t.dataType!=="json"){const u=(l,d)=>{if(!(!d||typeof d!="object")){if(Array.isArray(d))d.length>0&&u(l,d[0]);else if(!(d instanceof Date)&&!(d instanceof File)&&!(d instanceof FileList))throw new I(`Object found in form field "${l}". Set the dataType option to "json" and add use:enhance to use nested data structures. More information: https://superforms.rocks/concepts/nested-data`)}};for(const[l,d]of Object.entries(n.data))u(l,d)}}const o={formId:n.id,form:B(n.data),constraints:n.constraints??{},posted:n.posted,errors:B(n.errors),message:B(n.message),tainted:void 0,valid:n.valid,submitting:!1,shape:n.shape},a=o,c=G(t.id??n.id);function b(e){return Object.values(e).filter(u=>p(u)!==!1)}function p(e){return!e||typeof e!="object"||!("valid"in e&&"errors"in e&&typeof e.valid=="boolean")?!1:"id"in e&&typeof e.id=="string"?e.id:!1}const w=G(n.data),y={subscribe:w.subscribe,set:(e,i={})=>{const u=B(e);return Be(u,i.taint??!0),w.set(u)},update:(e,i={})=>w.update(u=>{const l=e(u);return Be(l,i.taint??!0),l})};function C(){return t.SPA===!0||typeof t.SPA=="object"}async function T(e={}){const i=e.formData??a.form;let u={},l;const d=e.adapter??t.validators;if(typeof d=="object"){if(d!=f&&!("jsonSchema"in d))throw new I('Client validation adapter found in options.validators. A full adapter must be used when changing validators dynamically, for example "zod" instead of "zodClient".');if(l=await d.validate(i),!l.success)u=Bt(l.issues,d.shape??a.shape??{});else if(e.recheckValidData!==!1)return T({...e,recheckValidData:!1})}else l={success:!0,data:{}};const m={...a.form,...i,...l.success?l.data:{}};return{valid:l.success,posted:!1,errors:u,data:m,constraints:a.constraints,message:void 0,id:a.formId,shape:a.shape}}function V(e){if(!t.onChange||!e.paths.length||e.type=="blur")return;let i;const u=e.paths.map(oe);e.type&&e.paths.length==1&&e.formElement&&e.target instanceof Element?i={path:u[0],paths:u,formElement:e.formElement,target:e.target,set(l,d,m){Ee({form:y},l,m).set(d)},get(l){return me(Ee(y,l))}}:i={paths:u,target:void 0,set(l,d,m){Ee({form:y},l,m).set(d)},get(l){return me(Ee(y,l))}},t.onChange(i)}async function E(e,i=!1,u){e&&(t.validators=="clear"&&q.update(m=>(Q(m,e.paths,void 0),m)),setTimeout(()=>V(e)));let l=!1;if(i||(t.validationMethod=="onsubmit"||t.validationMethod=="submit-only"||t.validationMethod=="onblur"&&(e==null?void 0:e.type)=="input"||t.validationMethod=="oninput"&&(e==null?void 0:e.type)=="blur")&&(l=!0),l||!e||!t.validators||t.validators=="clear"){if(e!=null&&e.paths){const m=(e==null?void 0:e.formElement)??X;m&&S(m,e.paths)}return}const d=await T({adapter:u});return d.valid&&(e.immediate||e.type!="input")&&y.set(d.data,{taint:"ignore"}),await De(),J(d.errors,e,i),d}function S(e,i){const u=new Map;if(t.customValidity&&e)for(const l of i){const d=CSS.escape(oe(l)),m=e.querySelector(`[name="${d}"]`);if(m){const A="validationMessage"in m?String(m.validationMessage):"";u.set(l.join("."),{el:m,message:A}),nt(m,void 0)}}return u}async function J(e,i,u){const{type:l,immediate:d,multiple:m,paths:A}=i,U=a.errors,F={};let Y=new Map;const N=i.formElement??X;N&&(Y=S(N,i.paths)),ee(e,L=>{if(!Array.isArray(L.value))return;const R=[...L.path];R[R.length-1]=="_errors"&&R.pop();const ae=R.join(".");function Z(){if(Q(F,[L.path],L.value),t.customValidity&&te&&Y.has(ae)){const{el:h,message:g}=Y.get(ae);g!=L.value&&(nt(h,L.value),Y.clear())}}if(u)return Z();const ge=L.path[L.path.length-1]=="_errors",te=L.value&&A.some(h=>ge?R&&h&&R.length>0&&R[0]==h[0]:ae==h.join("."));if(te&&t.validationMethod=="oninput"||d&&!m&&te)return Z();if(m){const h=re(me(q),L.path.slice(0,-1));if(h!=null&&h.value&&typeof(h==null?void 0:h.value)=="object"){for(const g of Object.values(h.value))if(Array.isArray(g))return Z()}}const v=re(U,L.path);if(v&&v.key in v.parent)return Z();if(ge){if(t.validationMethod=="oninput"||l=="blur"&&Et(oe(L.path.slice(0,-1))))return Z()}else if(l=="blur"&&te)return Z()}),q.set(F)}function O(e,i={}){return i.keepFiles&&ee(a.form,u=>{if(!(u.parent instanceof FileList)&&(u.value instanceof File||u.value instanceof FileList)){const l=re(e,u.path);(!l||!(l.key in l.parent))&&Q(e,[u.path],u.value)}}),y.set(e,i)}function ye(e,i){return e&&i&&t.resetForm&&(t.resetForm===!0||t.resetForm())}async function Ve(e,i){e.valid&&i&&ye(e.valid,i)?Te({message:e.message,posted:!0}):be({form:e,untaint:i,keepFiles:!0,skipFormData:t.invalidateAll=="force"}),H.onUpdated.length&&await De();for(const u of H.onUpdated)u({form:e})}function Te(e={}){e.newState&&(s.data={...s.data,...e.newState});const i=B(s);i.data={...i.data,...e.data},e.id!==void 0&&(i.id=e.id),be({form:i,untaint:!0,message:e.message,keepFiles:!1,posted:e.posted})}async function mt(e){if(e.type=="error")throw new I(`ActionResult of type "${e.type}" cannot be passed to update function.`);if(e.type=="redirect"){ye(!0,!0)&&Te({posted:!0});return}if(typeof e.data!="object")throw new I("Non-object validation data returned from ActionResult.");const i=b(e.data);if(!i.length)throw new I("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const u of i)u.id===a.formId&&await Ve(u,e.status>=200&&e.status<300)}const ie=G(o.message),Ae=G(o.constraints),_e=G(o.posted),$e=G(o.shape),Me=G(n.errors),q={subscribe:Me.subscribe,set(e,i){return Me.set(Qe(e,a.errors,i==null?void 0:i.force))},update(e,i){return Me.update(u=>Qe(e(u),a.errors,i==null?void 0:i.force))},clear:()=>q.set({})};let M=null;function pt(e){var i;M&&e&&Object.keys(e).length==1&&((i=e.paths)!=null&&i.length)&&M.target&&M.target instanceof HTMLInputElement&&M.target.type.toLowerCase()=="file"?M.paths=e.paths:M=e,setTimeout(()=>{E(M)},0)}function yt(e,i,u,l,d){M===null&&(M={paths:[]}),M.type=e,M.immediate=i,M.multiple=u,M.formElement=l,M.target=d}function He(){return(M==null?void 0:M.paths)??[]}function ht(){M=null}const K={state:G(),message:t.taintedMessage,clean:B(n.data)};function bt(){t.taintedMessage=K.message}function gt(){return K.state}function Et(e){if(!a.tainted)return!1;if(!e)return!!a.tainted;const i=re(a.tainted,le(e));return!!i&&i.key in i.parent}function Ue(e){if(typeof e=="boolean")return e;if(typeof e=="object")return he(e);if(!a.tainted)return!1;if(!e)return he(a.tainted);const i=re(a.tainted,le(e));return he(i==null?void 0:i.value)}function he(e){if(!e)return!1;if(typeof e=="object"){for(const i of Object.values(e))if(he(i))return!0}return e===!0}function Be(e,i){if(i=="ignore")return;const u=Ze(e,a.form),l=Ze(e,K.clean).map(d=>d.join());u.length&&(i=="untaint-all"||i=="untaint-form"?K.state.set(void 0):K.state.update(d=>(d||(d={}),Q(d,u,(m,A)=>{if(!l.includes(m.join()))return;const U=z(e,m),F=z(K.clean,m);return U&&F&&U.value===F.value?void 0:i===!0?!0:i==="untaint"?void 0:A.value}),d))),pt({paths:u})}function wt(e,i){K.state.set(e),i&&(K.clean=i)}const Fe=G(!1),qe=G(!1),Ye=G(!1),Ge=[K.state.subscribe(e=>o.tainted=B(e)),y.subscribe(e=>o.form=B(e)),q.subscribe(e=>o.errors=B(e)),c.subscribe(e=>o.formId=e),Ae.subscribe(e=>o.constraints=e),_e.subscribe(e=>o.posted=e),ie.subscribe(e=>o.message=e),Fe.subscribe(e=>o.submitting=e),$e.subscribe(e=>o.shape=e)];function vt(e){Ge.push(e)}function St(){Ge.forEach(e=>e())}let $;function Tt(e){$=document.createElement("form"),$.method="POST",$.action=e,ze($),document.body.appendChild($)}function At(e){$&&($.action=e)}function We(){$!=null&&$.parentElement&&($.remove(),$=void 0)}const _t=xe(q,e=>e?qt(e):[]);let X;t.taintedMessage=void 0;function be(e){const i=e.form,u=e.message??i.message;if(e.untaint&&wt(typeof e.untaint=="boolean"?void 0:e.untaint,i.data),e.skipFormData!==!0&&O(i.data,{taint:"ignore",keepFiles:e.keepFiles}),ie.set(u),q.set(i.errors),c.set(i.id),_e.set(e.posted??i.posted),i.constraints&&Ae.set(i.constraints),i.shape&&$e.set(i.shape),o.valid=i.valid,t.flashMessage&&Le(t)){const l=t.flashMessage.module.getFlash(de);u&&me(l)===void 0&&l.set(u)}}const H={onSubmit:t.onSubmit?[t.onSubmit]:[],onResult:t.onResult?[t.onResult]:[],onUpdate:t.onUpdate?[t.onUpdate]:[],onUpdated:t.onUpdated?[t.onUpdated]:[],onError:t.onError?[t.onError]:[]};{const e="Leave page? Changes that you made may not be saved.";let i=!1;jt(async u=>{if(t.taintedMessage&&!a.submitting&&!i&&Ue()){const{taintedMessage:l}=t,d=typeof l=="function";if(d&&u.cancel(),u.type==="leave")return;const m=d||l===!0?e:l;let A;try{A=d?await l():window.confirm(m)}catch{A=!1}if(A&&u.to)try{i=!0,await Pt(u.to.url,{...u.to.params});return}finally{i=!1}else!A&&!d&&u.cancel()}}),vt(de.subscribe(async u=>{ue&&u===void 0&&(u={status:200});const l=u.status>=200&&u.status<300;if(t.applyAction&&u.form&&typeof u.form=="object"){const d=u.form;if(d.type=="error")return;for(const m of b(d)){const A=se.has(m);m.id!==a.formId||A||(se.set(m,m),await Ve(m,l))}}else if(u.data&&typeof u.data=="object")for(const d of b(u.data)){const m=se.has(d);d.id!==a.formId||m||(t.invalidateAll==="force"&&(s.data=d.data),be({form:d,untaint:l,keepFiles:!ye(!0,!0)}))}})),typeof t.SPA=="string"&&Tt(t.SPA)}function ze(e,i){if(We(),X=e,i){if(i.onError){if(t.onError==="apply")throw new I('options.onError is set to "apply", cannot add any onError events.');if(i.onError==="apply")throw new I('Cannot add "apply" as onError event in use:enhance.');H.onError.push(i.onError)}i.onResult&&H.onResult.push(i.onResult),i.onSubmit&&H.onSubmit.push(i.onSubmit),i.onUpdate&&H.onUpdate.push(i.onUpdate),i.onUpdated&&H.onUpdated.push(i.onUpdated)}bt();let u;async function l(U){const F=rt(U.target);F.immediate&&!F.file&&await new Promise(Y=>setTimeout(Y,0)),u=He(),yt("input",F.immediate,F.multiple,e,U.target??void 0)}async function d(U){if(a.submitting||!u||He()!=u)return;const F=rt(U.target);F.immediate&&!F.file&&await new Promise(Y=>setTimeout(Y,0)),E({paths:u,immediate:F.multiple,multiple:F.multiple,type:"blur",formElement:e,target:U.target??void 0}),u=void 0}e.addEventListener("focusout",d),e.addEventListener("input",l),Pe(()=>{e.removeEventListener("focusout",d),e.removeEventListener("input",l),X=void 0});const m=Zt(e,{submitting:Fe,delayed:qe,timeout:Ye},t);let A;return Gt(e,async U=>{let F,Y=t.validators;const N={...U,jsonData(v){if(t.dataType!=="json")throw new I("options.dataType must be set to 'json' to use jsonData.");F=v},validators(v){Y=v}},L=N.cancel;let R=!1;function ae(v){var W;const h={...v,posted:!0},g=h.valid?200:(typeof t.SPA=="boolean"||typeof t.SPA=="string"||(W=t.SPA)==null?void 0:W.failStatus)??400,j={form:h},D=h.valid?{type:"success",status:g,data:j}:{type:"failure",status:g,data:j};setTimeout(()=>te({result:D}),0)}function Z(){switch(t.clearOnSubmit){case"errors-and-message":q.clear(),ie.set(void 0);break;case"errors":q.clear();break;case"message":ie.set(void 0);break}}function ce(v={resetTimers:!0}){return R=!0,v.resetTimers&&m.isSubmitting()&&m.completed({cancelled:R}),L()}if(N.cancel=ce,m.isSubmitting()&&t.multipleSubmits=="prevent")ce({resetTimers:!1});else{m.isSubmitting()&&t.multipleSubmits=="abort"&&A&&A.abort(),m.submitting(),A=N.controller;for(const v of H.onSubmit)await v(N)}if(R&&t.flashMessage&&et(t),!R){const v=!C()&&(e.noValidate||(N.submitter instanceof HTMLButtonElement||N.submitter instanceof HTMLInputElement)&&N.submitter.formNoValidate);let h;const g=async()=>await T({adapter:Y});if(Z(),v||(h=await g(),h.valid||(ce({resetTimers:!1}),ae(h))),!R){t.flashMessage&&(t.clearOnSubmit=="errors-and-message"||t.clearOnSubmit=="message")&&Le(t)&&t.flashMessage.module.getFlash(de).set(void 0);const j="formData"in N?N.formData:N.data;if(u=void 0,C())h||(h=await g()),ce({resetTimers:!1}),ae(h);else if(t.dataType==="json"){h||(h=await g());const D=B(F??h.data);ee(D,k=>{if(k.value instanceof File){const _="__superform_file_"+oe(k.path);return j.append(_,k.value),k.set(void 0)}else if(Array.isArray(k.value)&&k.value.length&&k.value.every(_=>_ instanceof File)){const _="__superform_files_"+oe(k.path);for(const x of k.value)j.append(_,x);return k.set(void 0)}}),Object.keys(D).forEach(k=>{typeof j.get(k)=="string"&&j.delete(k)});const W=ge(xt(D),t.jsonChunkSize??5e5);for(const k of W)j.append("__superform_json",k)}if(!j.has("__superform_id")){const D=a.formId;D!==void 0&&j.set("__superform_id",D)}typeof t.SPA=="string"&&At(t.SPA)}}function ge(v,h){const g=Math.ceil(v.length/h),j=new Array(g);for(let D=0,W=0;D<g;++D,W+=h)j[D]=v.substring(W,W+h);return j}async function te(v){var k;let h=!1;A=null;let g="type"in v.result&&"status"in v.result?v.result:{type:"error",status:parseInt(String(v.result.status))||500,error:v.result.error instanceof Error?v.result.error:v.result};const j=()=>h=!0,D={result:g,formEl:e,formElement:e,cancel:j},W=ue||!C()?()=>{}:Ke.subscribe(_=>{var x,ne;!_||((x=_.from)==null?void 0:x.route.id)===((ne=_.to)==null?void 0:ne.route.id)||j()});for(const _ of H.onResult)await _(D);if(g=D.result,!h){if((g.type==="success"||g.type=="failure")&&g.data){const _=b(g.data);if(!_.length)throw new I("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const x of _){if(x.id!==a.formId)continue;const ne={form:x,formEl:e,formElement:e,cancel:()=>h=!0};for(const ke of H.onUpdate)await ke(ne);h||(t.customValidity&&Wt(e,ne.form.errors),ye(ne.form.valid,g.type=="success")&&ne.formElement.querySelectorAll('input[type="file"]').forEach(ke=>ke.value=""))}}if(!h){if(g.type!=="error")g.type==="success"&&t.invalidateAll&&await st(),t.applyAction?await ve(g):await mt(g);else{if(t.applyAction)if(t.onError=="apply")await ve(g);else{const _={type:"failure",status:Math.floor(g.status||500),data:g};await ve(_)}if(t.onError!=="apply"){const _={result:g,message:ie};for(const x of H.onError)x!=="apply"&&(x!=ct||!((k=t.flashMessage)!=null&&k.onError))&&await x(_)}}t.flashMessage&&g.type=="error"&&t.flashMessage.onError&&await t.flashMessage.onError({result:g,flashMessage:t.flashMessage.module.getFlash(de)})}}if(h&&t.flashMessage&&et(t),h||g.type!="redirect")m.completed({cancelled:h});else if(ue)m.completed({cancelled:h,clearAll:!0});else{const _=Ke.subscribe(x=>{x||(setTimeout(()=>{try{_&&_()}catch{}}),m.isSubmitting()&&m.completed({cancelled:h,clearAll:!0}))})}W()}return te})}return{form:y,formId:c,errors:q,message:ie,constraints:Ae,tainted:gt(),submitting:Ie(Fe),delayed:Ie(qe),timeout:Ie(Ye),options:t,capture(){return{valid:a.valid,posted:a.posted,errors:a.errors,data:a.form,constraints:a.constraints,message:a.message,id:a.formId,tainted:a.tainted,shape:a.shape}},restore:e=>{be({form:e,untaint:e.tainted??!0})},async validate(e,i={}){if(!t.validators)throw new I("options.validators must be set to use the validate method.");i.update===void 0&&(i.update=!0),i.taint===void 0&&(i.taint=!1),typeof i.errors=="string"&&(i.errors=[i.errors]);let u;const l=le(e);"value"in i?i.update===!0||i.update==="value"?(y.update(A=>(Q(A,[l],i.value),A),{taint:i.taint}),u=a.form):(u=B(a.form),Q(u,[l],i.value)):u=a.form;const d=await T({formData:u}),m=re(d.errors,l);return m&&m.value&&i.errors&&(m.value=i.errors),(i.update===!0||i.update=="errors")&&q.update(A=>(Q(A,[l],m==null?void 0:m.value),A)),m==null?void 0:m.value},async validateForm(e={}){if(!t.validators&&!e.schema)throw new I("options.validators or the schema option must be set to use the validateForm method.");const i=e.update?await E({paths:[]},!0,e.schema):T({adapter:e.schema});return e.update&&X&&setTimeout(()=>{X&&Ne(X,{...t,scrollToError:e.focusOnError===!1?"off":t.scrollToError})},1),i||T({adapter:e.schema})},allErrors:_t,posted:_e,reset(e){return Te({message:e!=null&&e.keepMessage?a.message:void 0,data:e==null?void 0:e.data,id:e==null?void 0:e.id,newState:e==null?void 0:e.newState})},submit(e){const i=X||(e&&e instanceof HTMLElement?e.closest("form"):void 0);if(!i)throw new I("use:enhance must be added to the form to use submit, or pass a HTMLElement inside the form (or the form itself) as an argument.");const u=e&&(e instanceof HTMLButtonElement&&e.type=="submit"||e instanceof HTMLInputElement&&["submit","image"].includes(e.type));i.requestSubmit(u?e:void 0)},isTainted:Ue,enhance:ze}}new TextEncoder;let rn=!1;try{SUPERFORMS_LEGACY&&(rn=!0)}catch{}export{fn as s};
